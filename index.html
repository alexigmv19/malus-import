<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Simulateur Malus Import FR (CarAPI)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; text-align: center; }
    select, input, button { margin: 1em; padding: 0.5em; width: 80%; max-width: 300px; }
    #result { margin-top: 2em; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Simulateur Malus Import FR (CarAPI)</h1>
  <label>Marque :</label>
  <select id="marque"><option>Chargement...</option></select><br />

  <label>Modèle :</label>
  <select id="modele"><option>---</option></select><br />

  <label>Version :</label>
  <select id="version"><option>---</option></select><br />

  <label>Année de mise en circulation :</label>
  <input type="number" id="annee" placeholder="ex: 2020" /><br />

  <button onclick="calculerMalus()">Calculer le Malus</button>

  <div id="result"></div>

  <script>
    const headers = {
      "x-rapidapi-host": "car-api2.p.rapidapi.com",
      "x-rapidapi-key": "TA_CLE_API_ICI" // Remplace cette valeur par ta vraie clé
    };

    async function chargerMarques() {
      try {
        const res = await fetch("https://car-api2.p.rapidapi.com/api/makes?direction=asc&sort=make", { headers });
        const data = await res.json();
        const select = document.getElementById("marque");
        select.innerHTML = '<option value="">Sélectionnez une marque</option>';
        data.data.forEach(marque => {
          const opt = document.createElement("option");
          opt.value = marque.make;
          opt.textContent = marque.make;
          select.appendChild(opt);
        });
      } catch (e) {
        document.getElementById("marque").innerHTML = "<option>Erreur de chargement</option>";
        console.error(e);
      }
    }

    document.getElementById("marque").addEventListener("change", async (e) => {
      const marque = e.target.value;
      const modeleSelect = document.getElementById("modele");
      modeleSelect.innerHTML = "<option>Chargement...</option>";
      try {
        const res = await fetch("https://car-api2.p.rapidapi.com/api/models?make=" + marque, { headers });
        const data = await res.json();
        modeleSelect.innerHTML = '<option value="">Sélectionnez un modèle</option>';
        data.data.forEach(model => {
          const opt = document.createElement("option");
          opt.value = model.model;
          opt.textContent = model.model;
          modeleSelect.appendChild(opt);
        });
      } catch (e) {
        modeleSelect.innerHTML = "<option>Erreur</option>";
        console.error(e);
      }
    });

    async function calculerMalus() {
      const marque = document.getElementById("marque").value;
      const modele = document.getElementById("modele").value;
      const version = document.getElementById("version").value;
      const annee = document.getElementById("annee").value;
      if (!marque || !modele || !annee) {
        document.getElementById("result").innerText = "Veuillez remplir tous les champs.";
        return;
      }
      // Simulation simple en attendant les données CO2/poids
      document.getElementById("result").innerText = "Simulation du malus en cours (fonction non encore connectée)...";
    }

    chargerMarques();
  </script>
</body>
</html>
